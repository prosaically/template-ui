/**
 * Copyright (c) Egu365 Technologies, Inc. All rights reserved.
 * Licensed under the LGPL or a commercial license.
 * For LGPL see License.txt in the project root for license information.
 * For commercial licenses see https://www.egu365.com/
 *
 * Version: 5.10.3 (2022-03-31)
 */
(function () {
    "use strict";

    // 国际化
    tinymce.addI18n("zh_CN", {
        Multiplot: "多图上传",
        "Multiplot plugin": "多图上传插件"
    });

    // 注册插件
    tinymce.PluginManager.add("multiplot", function (editor, url) {
        // 生成器
        var randomizer = function () {
            var arr = [
                "a",
                "b",
                "c",
                "d",
                "e",
                "f",
                "g",
                "h",
                "i",
                "j",
                "k",
                "l",
                "m",
                "n",
                "o",
                "p",
                "q",
                "r",
                "s",
                "t",
                "u",
                "v",
                "w",
                "x",
                "y",
                "z",
                "A",
                "B",
                "C",
                "D",
                "E",
                "F",
                "G",
                "H",
                "I",
                "J",
                "K",
                "L",
                "M",
                "N",
                "O",
                "P",
                "Q",
                "R",
                "S",
                "T",
                "U",
                "V",
                "W",
                "X",
                "Y",
                "Z"
            ];
            var nonce = "";
            for (var i = 0; i < 10; i++) {
                var pos = Math.round(Math.random() * (arr.length - 1));
                nonce += arr[pos];
            }
            return nonce;
        };

        // 处理器
        var handler = function () {
            // 生成窗口 ID
            var id = randomizer();

            // 打开窗口
            let lang = editor.getParam("language", "en_US", "string");
            var dialog = editor.windowManager.openUrl({
                title: "Multiplot",
                size: "medium",
                url: url + "/" + lang + ".html?id=" + id,
                onClose: function () {
                    delete window[id];
                    id = undefined;
                }
            });

            // 绑定窗口
            window[id] = {tinymce: tinymce, editor: editor, dialog: dialog};
        };

        // 注册图标
        editor.ui.registry.addIcon(
            "Multiplot",
            '<svg t="1648711669785" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="772" width="24" height="24"><path d="M793.25878906 371.38378906C793.25878906 332.703125 761.61816406 301.0625 722.9375 301.0625s-70.32128906 31.640625-70.32128906 70.32128906 31.640625 70.32128906 70.32128906 70.32128907 70.32128906-31.640625 70.32128906-70.32128907z" p-id="773" fill="#222f3e"></path><path d="M90.125 160.44628906v703.13378906h421.875v-70.32128906H160.44628906V701.84375l210.9375-210.9375L512 631.52246094l49.22753906-49.22753907-189.84375-189.84374999-210.9375 210.93749999V230.74121094h703.13378906v210.9375L933.90136719 512V160.44628906z" p-id="774" fill="#222f3e"></path><path d="M874.10058594 712.390625l49.22753906-49.22753906-165.24316406-165.24316407-165.24316406 165.24316407 49.22753906 49.22753906L722.9375 631.52246094v161.70996093h70.32128906v-161.70996093zM582.32128906 863.55371094h70.32128907V933.875h-70.32128907v-70.32128906zM722.9375 863.55371094h70.32128906V933.875H722.9375v-70.32128906zM863.55371094 863.55371094H933.875V933.875h-70.32128906v-70.32128906z" p-id="775" fill="#222f3e"></path></svg>'
        );

        // 添加一个打开窗口的按钮
        editor.ui.registry.addButton("Multiplot", {
            tooltip: "Multiplot",
            icon: "Multiplot",
            onAction: handler
        });

        // 添加一个菜单项，然后可以通过菜单/菜单栏配置
        editor.ui.registry.addMenuItem("Multiplot", {
            icon: "Multiplot",
            text: "Multiplot",
            onAction: handler
        });

        // 返回插件的元数据
        return {
            getMetadata: function () {
                return {name: "Multiplot plugin", url: "https://www.egu365.com"};
            }
        };
    });
})();
